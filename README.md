# Streak Lover Backend

## 📋 프로젝트 개요

**Streak Lover Backend**는 사용자의 습관 형성과 목표 달성을 위한 스트릭(연속 기록) 관리 시스템의 백엔드 API 서버입니다. 이 시스템은 사용자가 개인적인 목표나 습관을 연속으로 수행하는 것을 추적하고, 동기부여를 제공하는 핵심 기능을 담당합니다.

### 🎯 핵심 목적
- **습관 형성 지원**: 사용자가 설정한 작업(습관/목표)의 일일 수행 여부를 기록하고 연속 기록을 관리
- **동기부여 플랫폼**: 스트릭 유지를 통한 사용자의 지속적인 참여 유도
- **알림 시스템**: 사용자가 설정한 시간에 스트릭 체크를 위한 푸시 알림 제공
- **복구 메커니즘**: 스트릭이 끊어졌을 때 복구할 수 있는 기능 제공

## 🛠 기술 스택

### 백엔드 핵심 기술
- **언어**: Java 17
- **프레임워크**: Spring Boot 3.3.2
- **데이터 접근**: Spring Data JPA
- **데이터베이스**: MySQL 8.0
- **빌드 도구**: Gradle
- **컨테이너화**: Docker Compose

### 외부 서비스 통합
- **Firebase Cloud Messaging**: 푸시 알림 서비스
- **Gmail SMTP**: 이메일 알림 서비스
- **Thymeleaf**: 이메일 템플릿 엔진

### 아키텍처 패턴
- **계층형 아키텍처**: Controller → Service → Repository
- **도메인 중심 설계**: User, Work, Streak 도메인 분리
- **RESTful API**: HTTP 기반 REST API 제공
- **세션 기반 인증**: HttpSession을 통한 사용자 인증

## 🏗 시스템 아키텍처

### 도메인 구조
```
src/main/java/com/example/streak/
├── user/          # 사용자 도메인 (인증, 정보 관리)
├── work/          # 작업 도메인 (습관/목표 관리)
├── streak/        # 스트릭 도메인 (연속 기록 관리)
├── email/         # 이메일 서비스
├── firebase/      # 푸시 알림 서비스
├── common/        # 공통 컴포넌트 (API, 에러 처리)
└── config/        # 설정 클래스들
```

### 데이터 모델 관계
- **User ↔ Work**: 1:N (한 사용자가 여러 작업 보유)
- **Work ↔ Streak**: 1:N (한 작업의 여러 일별 기록)
- **User ↔ Firebase**: 1:N (한 사용자의 여러 디바이스 토큰)

## 🚀 주요 기능

### 1. 사용자 관리 시스템
- **회원가입/로그인**: 이메일 인증 기반 사용자 등록
- **사용자 정보 관리**: 프로필 수정, 비밀번호 변경
- **Firebase 토큰 관리**: 푸시 알림을 위한 디바이스 토큰 등록
- **알림 시간 설정**: 개인화된 알림 시간 설정

### 2. 작업(습관/목표) 관리 시스템
- **작업 등록**: 사용자가 수행할 습관이나 목표 등록
- **작업 수정/삭제**: 기존 작업 정보 변경 및 삭제
- **주간 목표 설정**: 요일별 수행 여부 설정 (비트마스크 방식)
- **작업 순서 관리**: 사용자가 정의한 순서로 작업 정렬

### 3. 스트릭(연속 기록) 관리 시스템
- **일별 체크 기록**: 매일 작업 수행 여부를 비트마스크로 기록
- **연속 기록 추적**: 현재 연속 수행 일수 계산
- **월별 통계**: 월별 스트릭 기록 및 통계 관리
- **스트릭 복구**: 무료/유료 복구 시스템으로 실패 시 복구 가능

### 4. 알림 시스템
- **푸시 알림**: Firebase FCM을 통한 실시간 알림
- **이메일 알림**: Gmail SMTP를 통한 이메일 발송
- **정기 알림**: 스케줄러를 통한 정기적인 알림 발송
- **개인화 알림**: 사용자 정의 시간에 맞춘 알림

### 5. 동기부여 시스템
- **보상 시스템**: 작업 완료 시 가상 화폐 획득
- **복구 메커니즘**: 스트릭 끊김 시 복구 옵션 제공
- **진행률 시각화**: 연속 기록 및 통계 제공

## 🗄 데이터베이스 스키마

### 핵심 엔티티

#### User (사용자)
- `id`: 사용자 고유 ID
- `name`: 사용자 이름 (이메일)
- `password`: 암호화된 비밀번호
- `tempPassword`: 임시 비밀번호
- `state`: 사용자 상태 (NORMAL, DELETE)
- `workCount`: 최대 작업 수
- `alertTime`: 알림 시간 설정

#### Work (작업)
- `id`: 작업 고유 ID
- `name`: 작업 이름
- `descript`: 작업 설명
- `orderNum`: 정렬 순서
- `curStreak`: 현재 연속 기록
- `dayWeek`: 주간 목표 (비트마스크)
- `state`: 작업 상태 (NORMAL, DELETE)
- `money`: 보유 금액
- `repair`: 복구 가능 횟수

#### Streak (스트릭 기록)
- `id`: 스트릭 고유 ID
- `checkNum`: 일별 체크 기록 (비트마스크)
- `month`: 년월 (YYYYMM 형식)
- `work`: 작업 엔티티 참조

#### Firebase (푸시 알림)
- `id`: 토큰 고유 ID
- `token`: Firebase FCM 토큰
- `user`: 사용자 엔티티 참조

## 🔧 시스템 특징

### 동시성 처리
- `@EnableAsync`: 비동기 이메일 발송
- `@EnableScheduling`: 정기적인 알림 발송 (30분마다)
- 세션 기반 사용자 인증

### 보안 기능
- 비밀번호 암호화 (`Encrypt.java`)
- 세션 기반 인증
- 입력 데이터 검증 (`@Valid`)
- 이메일 인증 시스템

### 확장성
- 모듈화된 도메인 구조
- 설정 외부화 (환경 변수)
- Docker 컨테이너화
- RESTful API 설계

## 📡 API 구조

### 사용자 관리 API (`/api/user`)
- `GET /work` - 사용자의 작업 목록 조회
- `GET /logout` - 로그아웃
- `GET /user` - 사용자 정보 조회
- `POST /change` - 사용자 정보 수정
- `POST /firebase-token` - Firebase 토큰 저장
- `POST /alert-time` - 알림 시간 설정

### 작업 관리 API (`/api/work`)
- `POST /register` - 작업 등록
- `POST /extend` - 작업 연장 (스트릭 체크)
- `GET /{streakId}` - 스트릭 정보 조회
- `POST /delete` - 작업 삭제
- `POST /repair` - 무료 복구
- `POST /repair-buy` - 유료 복구

### 이메일 API (`/api/mail`)
- `POST /inquiry` - 문의 이메일 발송

### Firebase API (`/api/firebase`)
- `POST /alert` - 푸시 알림 테스트

## 🔔 알림 시스템

### 푸시 알림
- **Firebase FCM**: 실시간 푸시 알림
- **정기 알림**: 30분마다 스케줄러 실행
- **개인화**: 사용자 정의 알림 시간
- **조건부 알림**: 미완료 작업이 있을 때만 발송

### 이메일 알림
- **Gmail SMTP**: 이메일 발송 서비스
- **Thymeleaf 템플릿**: HTML 이메일 템플릿
- **문의 이메일**: 사용자 문의 처리
- **비밀번호 재설정**: 임시 비밀번호 발송

## 🧪 개발 환경

### 필수 환경
- Java 17
- MySQL 8.0
- Docker (선택사항)

### 환경 변수
```bash
# 데이터베이스
db.url=jdbc:mysql://localhost:3306/mydb
db.username=root
db.password=root1234!!

# 이메일
mail.password=your_gmail_app_password
```

### 실행 방법
```bash
# 데이터베이스 시작
docker-compose up -d

# 애플리케이션 실행
./gradlew bootRun
```

## 🎯 비즈니스 로직

### 스트릭 관리 로직
1. **일별 체크**: 비트마스크를 사용하여 월별 체크 기록 관리
2. **연속 기록 계산**: 마지막 업데이트 날짜 기준으로 연속 일수 계산
3. **복구 시스템**: 무료/유료 복구 옵션으로 사용자 동기부여
4. **보상 시스템**: 작업 완료 시 가상 화폐 획득

### 알림 로직
1. **정기 스케줄링**: 30분마다 알림 조건 확인
2. **개인화**: 사용자별 알림 시간 설정
3. **조건부 발송**: 미완료 작업이 있는 사용자에게만 알림
4. **다중 디바이스**: 한 사용자의 여러 디바이스에 동시 발송

이 시스템은 사용자의 습관 형성과 목표 달성을 지원하는 종합적인 백엔드 플랫폼으로, 기술적 안정성과 사용자 경험을 모두 고려한 설계를 제공합니다.
